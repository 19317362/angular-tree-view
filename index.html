<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Angular Tree View</title>

		<meta name="description" content="overview &amp; stats" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" />
		<!--[if IE 7]>
		  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome-ie7.min.css" />
		<![endif]-->
		
		<link rel="stylesheet" href="css/style.css" />
		<style>
			body {
				margin-bottom: 50px;
			}
		</style>
	</head>

	<body ng-app="Demo">
		<div class="container" ng-controller="DemoController">
			<h1>Tree View Example</h1>
			<h2>Normal</h2>
			<div class="row">
				<div class="span6">
					<div style="padding: 10px; border: 1px solid #aaa;">
						<ul class="breadcrumb" style="min-height: 20px; box-sizing: content-box">
							<li ng-repeat="b in breadcrumbs" ng-class="{ active: $last }">{{ b }}</li>
						</ul>
						<div>Root</div>
						<div tree-view="structure" tree-view-options="options"></div>
					</div>
				</div>
			</div>
			
			<h2>Non-collapsible (expanded)</h2>
			<div class="row">
				<div class="span6">
					<div style="padding: 10px; border: 1px solid #aaa;">
						<div style="padding: 1px 5px">
							<i class="fa fa-tablet icon-tablet"></i>
							Device
						</div>
						<div tree-view="structure" tree-view-options="options2"></div>
					</div>
				</div>
			</div>
			
			<h2>Custom file icons</h2>
			<div class="row">
				<div class="span6">
					<div style="padding: 10px; border: 1px solid #aaa;">
						<div style="padding: 1px 4px">
							<i class="fa fa-hdd-o icon-hdd"></i>
							Hard Drive
						</div>
						<div tree-view="structure" tree-view-options="options3"></div>
					</div>
				</div>
			</div>
		</div>
		
		<!--[if !IE]> -->
		<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
		<!-- <![endif]-->
		<!--[if IE]>
		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
		<![endif]-->
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.21/angular.min.js"></script>
		<script src="js/treeView.js"></script>
		<script>
			(function () {
				var app = angular.module('Demo', ['AxelSoft']);
				
				app.controller('DemoController', ['$scope', '$q', function ($scope, $q) {
					
					$scope.breadcrumbs = [];
					
					$scope.structure = { folders: [
						{ name: 'Folder 1', files: [{ name: 'File 1.jpg' }, { name: 'File 2.png' }], folders: [
							{ name: 'Subfolder 1', files: [{ name: 'Subfile 1.txt' }] },
							{ name: 'Subfolder 2' },
							{ name: 'Subfolder 3' }
						]},
						{ name: 'Folder 2' }
					], files: [{ name: 'File 1.gif' }, { name: 'File 2.gif' }]};
					
					var validName = /^(?=.*\w)[\w\.\s-]+$/;
					$scope.options = {
						onNodeSelect: function (node, breadcrumbs) {
							$scope.breadcrumbs = breadcrumbs;
						},
						onAdd: function (parent) {
							if (!parent.files) parent.files = [];
							var newFile = { name: 'File ' + parent.files.length };
							parent.files.push(newFile);
						},
						onEdit: function (node, name, parent) {
							if (!validName.test(name)) {
								return $q.reject("Invalid name");
							}
							if (hasName(parent.folders, node, name) || hasName(parent.files, node, name)) {
								return $q.reject("Name is duplicate");
							}
							
							// Accept change
							node.name = name;
							return true;
						},
						onRemove: function (node, parent) {
							debugger;
						}
					};
					
					function hasName(nodes, self, name) {
						if (nodes) {
							for (var i = 0; i < nodes.length; i++) {
								if (nodes[i] !== self && nodes[i].name === name) {
									return true;
								}
							}
						}
						return false;
					}
					
					$scope.options2 = {
						collapsible: false
					};
					
					var iconClassMap = {
						txt: 'fa-file-text-o icon-file-text',
						jpg: 'fa-file-picture-o icon-picture blue',
						png: 'fa-file-picture-o icon-picture orange',
						gif: 'fa-file-picture-o icon-picture'
					},
						defaultIconClass = 'icon-file';
					
					$scope.options3 = {
						mapIcon: function (file) {
							var pattern = /\.(\w+)$/,
								match = pattern.exec(file.name),
								ext = match && match[1];
							
							return iconClassMap[ext] || defaultIconClass;
						}
					};
				}]);
				
			})();
		</script>
	</body>
</html>
